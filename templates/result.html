{% extends "base.html" %}
{% block content %}
<div class="container">
    {% if using_custom_registry %}
    <div class="mb-5">
        <h2>Image Copy Commands</h2>
        <p class="text-muted mb-4">Run these commands first to copy images to your private registry:</p>
        
        {% if copy_commands.sensor %}
        <div class="command-section mb-4">
            <h4>Falcon Sensor Image Copy</h4>
            <div class="bg-light p-3 rounded">
                <pre><code class="helm-command">{{ copy_commands.sensor }}</code></pre>
                <button class="btn btn-secondary mt-2" onclick="copyCommand(this)">Copy Command</button>
            </div>
        </div>
        {% endif %}

        {% if copy_commands.kac %}
        <div class="command-section mb-4">
            <h4>KAC Image Copy</h4>
            <div class="bg-light p-3 rounded">
                <pre><code class="helm-command">{{ copy_commands.kac }}</code></pre>
                <button class="btn btn-secondary mt-2" onclick="copyCommand(this)">Copy Command</button>
            </div>
        </div>
        {% endif %}

        {% if copy_commands.iar %}
        <div class="command-section mb-4">
            <h4>IAR Image Copy</h4>
            <div class="bg-light p-3 rounded">
                <pre><code class="helm-command">{{ copy_commands.iar }}</code></pre>
                <button class="btn btn-secondary mt-2" onclick="copyCommand(this)">Copy Command</button>
            </div>
        </div>
        {% endif %}

        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> After running the copy commands above, proceed with the Helm installation commands below.
        </div>
    </div>
    {% endif %}

    <h2>Helm Installation Commands</h2>
    
    {% if commands.sensor %}
    <!-- Falcon Sensor Command -->
    <div class="command-section mb-4">
        <h3>Falcon Sensor</h3>
        <div class="bg-light p-3 rounded">
            <pre><code class="helm-command">{{ commands.sensor }}</code></pre>
            <button class="btn btn-secondary mt-2" onclick="copyCommand(this)">Copy Command</button>
        </div>
    </div>
    {% endif %}

    {% if commands.kac %}
    <!-- KAC Command -->
    <div class="command-section mb-4">
        <h3>Kubernetes Admission Controller</h3>
        <div class="bg-light p-3 rounded">
            <pre><code class="helm-command">{{ commands.kac }}</code></pre>
            <button class="btn btn-secondary mt-2" onclick="copyCommand(this)">Copy Command</button>
        </div>
    </div>
    {% endif %}

    {% if commands.iar %}
    <!-- IAR Command -->
    <div class="command-section mb-4">
        <h3>Image Assessment at Runtime</h3>
        <div class="bg-light p-3 rounded">
            <pre><code class="helm-command">{{ commands.iar }}</code></pre>
            <button class="btn btn-secondary mt-2" onclick="copyCommand(this)">Copy Command</button>
        </div>
    </div>
    {% endif %}

    {% if not commands %}
    <div class="alert alert-warning">
        No components selected. Please select at least one component to generate commands.
    </div>
    {% endif %}

    <a href="{{ url_for('main.index') }}" class="btn btn-primary mt-3">Back</a>
</div>

<style>
.helm-command {
    white-space: pre;
    word-wrap: normal;
    overflow-x: auto;
    font-family: monospace;
    padding: 15px;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
}

.command-section {
    margin-bottom: 2rem;
}

.alert {
    margin-top: 1rem;
    margin-bottom: 1rem;
}
</style>

<script>
function copyCommand(button) {
    // Get the command text from the pre>code element in the same command section
    const commandElement = button.parentElement.querySelector('.helm-command');
    const commandText = commandElement.textContent.trim();

    // Copy to clipboard
    navigator.clipboard.writeText(commandText).then(() => {
        // Temporarily change button text to show success
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('btn-success');
        button.classList.remove('btn-secondary');
        
        // Reset button after 2 seconds
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('btn-success');
            button.classList.add('btn-secondary');
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy:', err);
        alert('Failed to copy command');
    });
}
</script>
{% endblock %}
